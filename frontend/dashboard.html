<!DOCTYPE html>
<html>

<head>
    <title>My Bookings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        fetch('http://localhost/event%20booking/backend/auth/check_role.php?expected=user')
            .then(res => res.json())
            .then(data => {
                if (!data.ok) {
                    window.location.href = 'admin-dashboard.html';
                }
            });
    </script>
    <style>
        body { background-color: #f8f9fa; }
        h2 { color: #ffbf00; text-align: center; margin-top: 20px; }
        .table { border-radius: 10px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .btn-danger { background-color: #dc3545; border-color: #dc3545; }
        .btn-danger:hover { background-color: #c82333; }
    </style>
</head>

<body>
    <div class="container">
        <h2>My Bookings</h2>
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="table-warning">
                    <tr>
                        <th>Event</th>
                        <th>Tickets</th>
                        <th>Total Amount</th>
                        <th>Status</th>
                        <th>Booking Date</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="bookingsTable"></tbody>
            </table>
        </div>
        <div class="text-center mt-3">
            <a href="http://localhost/event%20booking/backend/auth/logout.php" class="btn btn-secondary">Logout</a>
        </div>
    </div>

    <script>
        fetch('http://localhost/event%20booking/backend/bookings/user-bookings.php')
            .then(res => res.json())
            .then(bookings => {
                const tbody = document.getElementById('bookingsTable');
                if (bookings.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No bookings found.</td></tr>';
                    return;
                }
                bookings.forEach(b => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${b.title}</td>
                        <td>${b.tickets}</td>
                        <td>$${b.total_amount}</td>
                        <td><span class="badge bg-${b.booking_status === 'confirmed' ? 'success' : 'secondary'}">${b.booking_status}</span></td>
                        <td>${b.booking_date}</td>
                        <td>${b.booking_status === 'confirmed' ? `<form method='POST' action='http://localhost/event%20booking/backend/bookings/cancel-booking.php' style='display:inline;'><input type='hidden' name='id' value='${b.id}'><button type='submit' class='btn btn-danger btn-sm' onclick="return confirm('Cancel this booking?')">Cancel</button></form>` : ''}</td>
                    `;
                    tbody.appendChild(row);
                });
            })
            .catch(err => {
                document.getElementById('bookingsTable').innerHTML = '<tr><td colspan="6" class="text-center text-danger">Error loading bookings.</td></tr>';
            });
    </script>
</body>

</html>